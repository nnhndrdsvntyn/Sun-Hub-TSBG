-- Create ESP for a specific player
local function createDeathCounterESP(player)
    -- Skip if the player is the local player
    if player == game.Players.LocalPlayer then return end

    -- Check if the player has the "HoldingDeathCounter" attribute set to true
    if player:GetAttribute("HoldingDeathCounter") then
        local playerModel = workspace.Live:FindFirstChild(player.Name)
        
        if playerModel then
            -- Create ESP components (BillboardGui + aura cubes)
            local billboardGui = Instance.new("BillboardGui")
            billboardGui.Adornee = playerModel.Head
            billboardGui.Size = UDim2.new(0, 200, 0, 50)
            billboardGui.StudsOffset = Vector3.new(0, 4, 0)
            billboardGui.AlwaysOnTop = true
            billboardGui.Parent = playerModel.Head

            local backgroundFrame = Instance.new("Frame")
            backgroundFrame.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
            backgroundFrame.Size = UDim2.new(1, 0, 1, 0)
            backgroundFrame.Parent = billboardGui

            local uiCorner = Instance.new("UICorner")
            uiCorner.CornerRadius = UDim.new(0, 10)
            uiCorner.Parent = backgroundFrame

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = Color3.fromRGB(0, 0, 0)
            uiStroke.Thickness = 4
            uiStroke.Parent = backgroundFrame

            local textLabel = Instance.new("TextLabel")
            textLabel.Text = "☠ Has Death Counter ☠"
            textLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
            textLabel.TextSize = 20
            textLabel.Font = Enum.Font.SourceSansBold
            textLabel.BackgroundTransparency = 1
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.Parent = billboardGui

            -- Create aura cubes around the player body parts
            local auraCubes = {}
            local bodyParts = {playerModel.Head, playerModel["Left Arm"], playerModel["Right Arm"], playerModel["Left Leg"], playerModel["Right Leg"], playerModel.Torso}

            for _, part in ipairs(bodyParts) do
                if part then
                    local auraCube = Instance.new("Part")
                    auraCube.Size = part.Size * 1.25
                    auraCube.Position = part.Position
                    auraCube.Color = Color3.fromRGB(255, 0, 0)
                    auraCube.Anchored = true
                    auraCube.CanCollide = false
                    auraCube.Transparency = 0.5
                    auraCube.Material = Enum.Material.Neon
                    auraCube.Parent = workspace
                    table.insert(auraCubes, auraCube)

                    -- Update aura cube to follow body part
                    RunService.Heartbeat:Connect(function()
                        auraCube.Position = part.Position
                        auraCube.CFrame = part.CFrame
                    end)
                end
            end

            -- Store the ESP components for this player
            espComponents[player.Name] = {billboardGui = billboardGui, auraCubes = auraCubes}

            -- Set the "HoldingDeathCounter" attribute to false for this player
            player:SetAttribute("HoldingDeathCounter", false)

            -- Remove the ESP and aura cubes after 10.75 seconds
            wait(10.75)
            removeDeathCounterESP(player)
        end
    end
end
